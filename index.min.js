var adt=function(){"use strict";const d="adt";function P(e){return e&&typeof e=="object"&&!Array.isArray(e)&&typeof e.year=="string"&&typeof e.month=="string"&&typeof e.day=="string"&&typeof e.hour=="string"&&typeof e.minute=="string"&&typeof e.second=="string"&&["AM","PM"].includes(e.ampm)}var U="gphotos-auto-datetime",F="0.0.1-alpha.1";class ${constructor(t){this.prefix=t}print(t,...n){const o=["[%s]"],r=[U],a=this.prefix?.();a&&(o.push(a.message),r.push(...a.args)),n.length>0&&o.push(n[0]);const i=[o.join(" ")].concat(r,n.slice(1));console[t](...i)}log(...t){this.print("log",...t)}warn(...t){this.print("warn",...t)}error(...t){this.print("error",...t)}}function m(e,t=2){return String(e).padStart(t,"0")}function q(e,t){const n=e?Number(e):null;if(n!=null&&n>=0&&n<t)return n}function b(e){let t;const n=e.hour12&&(t=q(e.hour12,12))!=null?{hour:t,ampm:e.ampm||"AM"}:(t=q(e.hour24,24))!=null?{hour:t===0||t===12?12:t-(t<12?0:12),ampm:t<12?"AM":"PM"}:null;if(!n)return;const{year:o}=e,r=m(e.month),a=m(e.day),i=m(n.hour),s=m(e.minute),u=m(e.second),E=n.ampm.toUpperCase();return{year:o,month:r,day:a,hour:i,minute:s,second:u,ampm:E}}const z=/(\d{2})\/(\d{2})\/(\d{4}), (\d{2}):(\d{2}):(\d{2}) (AM|PM)/i;function g(e){if(isNaN(+e))return;const t=new Intl.DateTimeFormat("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}).format(e).match(z);if(t?.length===8){const[,n,o,r,a,i,s,u]=t,E=u.toUpperCase();return{year:r,month:n,day:o,hour12:a,minute:i,second:s,ampm:E}}}const I={name:"date",parse(e){return g(new Date(e))}},j=[/(\d{4})(\d{2})(\d{2})[_-]?(\d{2})(\d{2})(\d{2})/,/(\d{4})-(\d{2})-(\d{2})[\s_](\d{2})-(\d{2})-(\d{2})/],V={name:"default",parse(e){for(const t of j){const n=e.match(t);if(n?.length===7){const[,o,r,a,i,s,u]=n;return{year:o,month:r,day:a,hour24:i,minute:s,second:u}}}}},_=/\d{1,2} \w+ \d{4} \d{2}∶\d{2}∶\d{2}/,B=[V,{name:"nautilus-date",parse(e){const t=e.match(_);if(t){const n=t[0].replace(/∶/g,":");return g(new Date(n))}}},I];function w(e){for(const t of B){const n=t.parse(e);if(n)return b(n)}}function A(e){return!!e&&e.getBoundingClientRect().height>0}function M(e){for(const t of e)if(A(t))return t}function y(){const e=M(document.querySelectorAll("dl")),t=e?.querySelector('dd [aria-label^="Filename:"]'),n=e?.querySelector('dd [aria-label^="Date taken:"]')?.parentElement?.parentElement,o=t?.textContent;if(o&&e&&n)return{name:o,dlEl:e,dateDetailsEl:n}}function k(e){const t=e.dlEl?.querySelector('dd [aria-label^="Date taken:"]'),n=e.dlEl?.querySelector('dd [aria-label^="Time taken:"]'),o=t?.textContent,r=n?.textContent;if(!o||!r)return;const a=o.includes(",")?o:o+", "+new Date().getFullYear(),i=r.replace(/\s/g," ").split(", ")[1],s=g(new Date(`${a} ${i}`));return s&&b(s)}function x(e,t){if(e==null)return t||=y(),t&&w(t.name);if(typeof e=="string")return w(e);if(e instanceof Date){const n=g(e);return n&&b(n)}if(P(e))return e}function f(e,t=e){const n=Math.floor(Math.random()*(t-e+1)+e);return new Promise(o=>setTimeout(o,n))}function C(e,t){return["year","month","day","hour","minute","ampm"].every(n=>e[n]===t[n])}async function L(e,t){const n=[e.year,e.month,e.day,e.hour,e.minute],o={bubbles:!0,cancelable:!1,composed:!0};for(let a=0;a<n.length;a++){const i=t[a],s=n[a];i.value!==s&&(await f(50,150),i.click(),await f(10),i.value=s,await f(10),i.dispatchEvent(new Event("input",o)),await f(10),i.dispatchEvent(new Event("blur",o)),await f(50,150))}const r=t[n.length];r.value!==e.ampm&&(r.click(),await f(50,150))}async function T(e,t,n){const o={break:!0},r=k(t);if(!r)return e.error("Unable to parse date and time."),o;if(C(n,r))e.log("Photo %o already has the correct date and time. Skipping.",t.name),o.skipped=!0;else{t.dateDetailsEl.click();const a=document.querySelector("div[data-back-to-cancel]");if(!a)return e.error("Unable to find 'Edit Date & Time' dialog."),o;const i=a.querySelectorAll("input");if(i.length!==6)return e.error("Unable to find 'Edit Date & Time' dialog fields."),o;await L(n,i),await f(200,400);const s=a.querySelectorAll("button"),u=s[1];if(!u)return e.error("Unable to find the 'Save' dialog action button."),o;u.click(),e.log("Saved date and time for %o. Parsed: %o",t.name,n),await f(1e3,1500),o.infoDate=k(t),o.success=!!o.infoDate&&C(n,o.infoDate)}return o.break=!1,o}const Y={name:U,version:F};function D(e,t){const n=`View ${t} photo`,o=M(document.querySelectorAll("c-wiz[data-media-key]"))?.parentElement?.querySelector(`div[role=button][aria-label="${n}"]`);if(!o)e.error("Unable to find the %o photo button.",t);else if(!A(o))e.warn("The %o photo button is not visible (%s of photos).",t,t==="next"?"end":"start");else return o.click(),!0}let p=!1,c,h={success:0,skipped:0},v;async function G(){let e=1,t=0,n;const o=new $(()=>({message:"[%o]",args:[e]}));function r(){return t++<5}for(;!p;){await f(500,1500);const a=y();if(!a){if(!r()){o.error("Unable to find the file name.");break}o.warn("Unable to find the file name. Retrying %o of %o.",t,5);continue}if(n===a.name){if(!r()){o.error("File name %o did not change.",n);break}o.warn("File name %o did not change. Retrying %o of %o.",n,t,5);continue}n=a.name;const i=typeof v=="function"&&v(a.name),s=P(i)?i:w(a.name);if(!s){o.error("Unable to parse name: %o",a.name);break}const u=await T(o,a,s);if(u.success&&h.success++,u.skipped&&h.skipped++,p||u.break)break;if(u.success===!1){if(o.warn("Photo date and time not updated for %o. Parsed: %o Details: %o",a.name,s,u.infoDate),!r())break;continue}if(!D(o,"next"))break;e++,t=0}}const l=new $;function N(e,t,...n){l.log(`${t}
- Success: %o
- Skipped: %o
- Total: %o`,...n,e.success,e.skipped,e.success+e.skipped)}function S(){l.warn("Cannot perform this action while %o is running. Enter %o to stop.",d,`${d}.stop()`)}const R={meta:Y,info(){const e=y();return e&&{name:e.name,date:k(e)}},next(){if(c)return S();D(l,"next")},previous(){if(c)return S();D(l,"previous")},parse(e){return x(e)},async input(e){if(c)return S();const t=y();if(!t){l.error("Unable to parse date and time info.");return}const n=x(e,t);if(!n){l.error("Unable to parse input: %o",e);return}await T(l,t,n)},start(e){v=e;const t="Enter %o to stop and %o to check status.",n=[`${d}.stop()`,`${d}.status()`];return c?l.warn(`%o already started. ${t}`,d,...n):(l.log(`Starting %o. ${t}`,d,...n),p=!1,h={success:0,skipped:0},c=G().finally(()=>{c=void 0,N(h,"%s. Enter %o to start again.",p?"Stopped":"Done",`${d}.start()`)})),c},stop(){return p=!0,c&&l.log("Stopping %o.",d),c},status(){N(h,"Status: %o",c?"Running":"Not Running")}};async function H(){const e=window[d];e&&typeof e=="object"&&typeof e.stop=="function"&&await e.stop(),p||R.start()}return H(),R}();
